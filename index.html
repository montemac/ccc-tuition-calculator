<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <title>Tuition Calculator</title>
  </head>
  <body>

    <form>
      <div class="form-group">
        <label for="selectBucket">Select your tuition bucket</label>
        <select class="form-control" id="selectBucket" onchange="calculate()">
          <option>A</option>
          <option selected>B</option>
          <option>C</option>
          <option>D</option>
          <option>E</option>
        </select>
      </div>
      <div class="form-group row">
        <label class="col-sm-5 col-form-label">Care type</label>
        <label class="col-sm-2 col-form-label">Monthly cost per selected day</label>
        <label class="col-sm-2 col-form-label">Select days per week</label>
        <label class="col-sm-2 col-form-label">Total monthly cost</label>
      </div>
      <div class="form-group row">
        <label for="priceBase" class="col-sm-5 col-form-label">Base tuition</label>
        <div class="col-sm-6">
          <input type="text" readonly class="form-control" id="priceBase" value="" onchange="calculate()">
        </div>
      </div>
      <div class="form-group row">
        <label for="priceEAM" class="col-sm-5 col-form-label">Early morning care (EAM), 8-9am</label>
        <div class="col-sm-2">
          <input type="text" readonly class="form-control" id="priceEAM" value="" onchange="calculate()">
        </div>
        <div class="col-sm-2">
          <select class="form-control" id="selectEAM" onchange="calculate()">
            <option>0</option>
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
          </select>
        </div>
        <div class="col-sm-2">
          <input type="text" readonly class="form-control" id="totalEAM" value="">
        </div>
      </div>
      <div class="form-group row">
        <label for="pricePM1" class="col-sm-5 col-form-label">Early afternoon care (PM1), 12:30-3:30pm</label>
        <div class="col-sm-2">
          <input type="text" readonly class="form-control" id="pricePM1" value="" onchange="calculate()">
        </div>
        <div class="col-sm-2">
          <select class="form-control" id="selectPM1" onchange="calculate()">
            <option>0</option>
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
          </select>
        </div>
        <div class="col-sm-2">
          <input type="text" readonly class="form-control" id="totalPM1" value="">
        </div>
      </div>
      <div class="form-group row">
        <label for="pricePM2" class="col-sm-5 col-form-label">Late afternoon care (PM2), 3:30-5:30pm</label>
        <div class="col-sm-2">
          <input type="text" readonly class="form-control" id="pricePM2" value="" onchange="calculate()">
        </div>
        <div class="col-sm-2">
          <select class="form-control" id="selectPM2" onchange="calculate()">
            <option>0</option>
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
          </select>
        </div>
        <div class="col-sm-2">
          <input type="text" readonly class="form-control" id="totalPM2" value="">
        </div>
      </div>
      <div id="calculatorResult" class="alert alert-success" role="alert">
        
      </div>
    </form>

    <script>

// JS Code to run the calculate whenever a value is changed

// Prices are defined in integer cents to avoid floating point issues
const AMOUNTS = {
	"Base": {
    "B": 76700,
    "C": 85200,
    "D": 93700,
    "E": 102200
  },
  "EAM": {
    "B": 4500,
    "C": 5000,
    "D": 5500,
    "E": 6000
  },
  "PM1": {
    "B": 13410,
    "C": 14900,
    "D": 16390,
    "E": 17880
	},
  "PM2": {
    "B": 9000,
  	"C": 10000,
  	"D": 11000,
  	"E": 12000
  }
};

function calculate() {
	// Get the chosen tuition bucket
  let e = document.getElementById("selectBucket");
  let bucket = e.options[e.selectedIndex].text;
  
  // Update header
  // e = document.getElementById("priceHeader");
  // e.innerHTML = `Montly cost (bucket ${bucket})`;
  
  // If A, enable the write-in entry widget, and calculate the derived
  // prices, with any limits / error detection on the entered price
  let amounts = {};
  var error = null;
  if (bucket == "A") {
  	for (const [key, value] of Object.entries(AMOUNTS)) {
      e = document.getElementById(`price${key}`);
      e.readOnly = false;
      let amount_this = parseFloat(e.value.replace("$","")) * 100;
      if (isNaN(amount_this)) {
        amounts[key] = 0;
      }
      else
      	amounts[key] = amount_this;
    }
  }
  // If not A, pull out the appropriate prices from the lists
	else {
    for (const [key, value] of Object.entries(AMOUNTS)) {
      amounts[key] = value[bucket];
      e = document.getElementById(`price${key}`);
    	e.readOnly = true;
    }
  }
  
  // Update pricing to have the right format
  for (const [key, value] of Object.entries(AMOUNTS)) {
    e = document.getElementById(`price${key}`);
    e.value = "$" + (amounts[key] / 100).toFixed(2);
  }
  
  // Pull the days of care selected, and calculate the final price
  let num_days = {"Base": 1};
  let price = amounts["Base"];
  for (const id of ["selectEAM", "selectPM1", "selectPM2"]) {
  	e = document.getElementById(id);
    const num_days_this = parseInt(e.options[e.selectedIndex].text);
    const care_name = id.split("select")[1];
    const total_this = amounts[care_name] * num_days_this
    price += total_this;
    e = document.getElementById(`total${care_name}`);
    e.value = "$" + (total_this / 100).toFixed(2);
  }
  let price_dollars = price / 100;
  
  // Display the final price or error
  e = document.getElementById("calculatorResult");
  if (error) {
    e.innerHTML = error;
    e.className = "alert alert-danger";
  }
  else {
  	e.innerHTML = "Total monthly tuition payment: $" + price_dollars.toFixed(2);
    e.className = "alert alert-success";
  }
}

calculate();

		</script>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  </body>
</html>